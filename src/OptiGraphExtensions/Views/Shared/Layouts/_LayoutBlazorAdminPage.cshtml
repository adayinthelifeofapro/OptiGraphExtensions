@using EPiServer.Framework.Web.Resources
@using EPiServer.Shell.Navigation
@using EPiServer.Shell.UI.Helpers.Internal

@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@addTagHelper *, EPiServer.Shell.UI

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Opti Graph Extensions</title>

    <!-- Shell -->
    @ClientResources.RenderResources("ShellCore")

    <!-- LightTheme -->
    @ClientResources.RenderResources("ShellCoreLightTheme")
    
    <style>
        html, body {
            overflow: auto !important;
            height: auto !important;
        }
        main {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            max-width: 1000px;
        }
        div.criteriabox {
            border: 2px solid #e0e0e0;
            border-radius: 0.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            padding: 1rem;
        }
    </style>

    <base href="~/" />
</head>
<body>
    @Html.AntiForgeryToken()
    <platform-navigation />
    <div style="padding-top: 56px; padding-left: 10px; padding-right: 10px; background: white;">
        @RenderBody()
    </div>

    <script src="_framework/blazor.server.js"></script>
    <script>
        // CSV download function for Query Library
        window.downloadCsv = function(filename, base64Content) {
            try {
                // Decode base64 to binary
                const byteCharacters = atob(base64Content);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);

                // Create blob and download
                const blob = new Blob([byteArray], { type: 'text/csv;charset=utf-8' });
                const url = URL.createObjectURL(blob);

                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();

                // Cleanup
                setTimeout(function() {
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }, 100);

                return true;
            } catch (error) {
                console.error('CSV download failed:', error);
                throw error;
            }
        };
    </script>
</body>
</html>