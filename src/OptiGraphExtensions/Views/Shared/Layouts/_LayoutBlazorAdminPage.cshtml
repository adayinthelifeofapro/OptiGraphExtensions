@using EPiServer.Framework.Web.Resources
@using EPiServer.Shell.Navigation
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Opti Graph Extensions</title>

    <!-- Shell -->
    @ClientResources.RenderResources("ShellCore")

    <!-- LightTheme -->
    @ClientResources.RenderResources("ShellCoreLightTheme")
    
    <style>
        main {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            max-width: 1000px;
        }
        div.criteriabox {
            border: 2px solid #e0e0e0;
            border-radius: 0.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            padding: 1rem;
        }
    </style>

    <base href="~/" />
</head>
<body>
    @Html.AntiForgeryToken() <!-- Thanks to: https://world.optimizely.com/blogs/matthew-slim/dates/2023/6/new-menu-system-released/ -->
    @Html.CreatePlatformNavigationMenu()
    <div @Html.ApplyPlatformNavigation() style="padding-left: 10px;background: white;padding: 1rem;">

    @RenderBody()

    </div>
    <script src="_framework/blazor.server.js"></script>
    <script>
        // CSV download function for Query Library
        window.downloadCsv = function(filename, base64Content) {
            try {
                // Decode base64 to binary
                const byteCharacters = atob(base64Content);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);

                // Create blob and download
                const blob = new Blob([byteArray], { type: 'text/csv;charset=utf-8' });
                const url = URL.createObjectURL(blob);

                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();

                // Cleanup
                setTimeout(function() {
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }, 100);

                return true;
            } catch (error) {
                console.error('CSV download failed:', error);
                throw error;
            }
        };
    </script>
</body>
</html>